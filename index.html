<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fake Trading Demo</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b1020;
      color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .app {
      background: #151a2c;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
      width: 420px;
    }

    h1 {
      margin: 0 0 16px;
      font-size: 1.3rem;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 12px;
    }

    .label {
      opacity: 0.7;
      font-size: 0.8rem;
    }

    .price {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .pill {
      display: inline-block;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 0.75rem;
      background: #1f2640;
      margin-left: 8px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin: 16px 0;
    }

    .stat-card {
      background: #1a2138;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 0.9rem;
    }

    .stat-label {
      opacity: 0.7;
      font-size: 0.75rem;
      margin-bottom: 4px;
    }

    .stat-value {
      font-weight: 600;
    }

    .stat-value.positive {
      color: #4ade80;
    }

    .stat-value.negative {
      color: #fb7185;
    }

    .buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }

    button {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 10px;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.9rem;
      transition: transform 0.07s ease, box-shadow 0.07s ease, opacity 0.2s;
    }

    button.primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #fff;
      box-shadow: 0 6px 15px rgba(34, 197, 94, 0.4);
    }

    button.secondary {
      background: #1e293b;
      color: #e5e7eb;
    }

    button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: none;
    }

    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .log {
      background: #111827;
      border-radius: 10px;
      padding: 10px 12px;
      height: 90px;
      overflow-y: auto;
      font-size: 0.8rem;
      border: 1px solid #1f2937;
    }

    .log-entry {
      margin-bottom: 4px;
      opacity: 0.9;
    }

    .log-entry span.time {
      opacity: 0.6;
      margin-right: 4px;
    }

    .footer {
      margin-top: 10px;
      font-size: 0.7rem;
      opacity: 0.6;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>VibeTrade Demo <span class="pill">Simulation</span></h1>

    <div class="price-row">
      <div>
        <div class="label">Current Price</div>
        <div class="price" id="priceDisplay">$100.00</div>
      </div>
      <div style="text-align:right;">
        <div class="label">Trend</div>
        <div id="trendLabel">Neutral</div>
      </div>
    </div>

    <div class="grid">
      <div class="stat-card">
        <div class="stat-label">Position Size</div>
        <div class="stat-value" id="positionDisplay">0 units</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Average Entry</div>
        <div class="stat-value" id="avgEntryDisplay">–</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Unrealized PnL</div>
        <div class="stat-value" id="pnlDisplay">$0.00</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Last Action</div>
        <div class="stat-value" id="lastActionDisplay">None</div>
      </div>
    </div>

    <div class="buttons">
      <button class="primary" id="buyBtn">Buy 1</button>
      <button class="secondary" id="sellBtn">Sell 1</button>
    </div>

    <button class="secondary" id="resetBtn" style="width:100%; margin-bottom:12px;">
      Reset Simulation
    </button>

    <div class="label" style="margin-bottom:4px;">Event Log</div>
    <div class="log" id="log"></div>

    <div class="footer">
      School project demo – no real trading.
    </div>
  </div>

  <script>
    // --- Simulation state ---
    let price = 100;
    let position = 0;
    let avgEntry = 0;
    let unrealizedPnl = 0;

    // "Magic" knobs
    let trendBoost = 0;         // temporary upward/downward bias
    let trendTicksLeft = 0;     // how many ticks the bias lasts

    const baseVolatility = 0.15;   // normal random move per tick
    const tickMs = 600;            // update frequency (ms)

    // --- DOM elements ---
    const priceDisplay = document.getElementById("priceDisplay");
    const positionDisplay = document.getElementById("positionDisplay");
    const avgEntryDisplay = document.getElementById("avgEntryDisplay");
    const pnlDisplay = document.getElementById("pnlDisplay");
    const lastActionDisplay = document.getElementById("lastActionDisplay");
    const trendLabel = document.getElementById("trendLabel");
    const logEl = document.getElementById("log");

    const buyBtn = document.getElementById("buyBtn");
    const sellBtn = document.getElementById("sellBtn");
    const resetBtn = document.getElementById("resetBtn");

    // --- Helpers ---
    function formatMoney(x) {
      return "$" + x.toFixed(2);
    }

    function log(message) {
      const now = new Date();
      const time = now.toLocaleTimeString();
      const div = document.createElement("div");
      div.className = "log-entry";
      div.innerHTML = `<span class="time">[${time}]</span>${message}`;
      logEl.prepend(div);
    }

    function updateUi() {
      priceDisplay.textContent = formatMoney(price);
      positionDisplay.textContent = position + " units";
      avgEntryDisplay.textContent = position === 0 ? "–" : formatMoney(avgEntry);

      pnlDisplay.textContent = formatMoney(unrealizedPnl);
      pnlDisplay.classList.remove("positive", "negative");
      if (unrealizedPnl > 0.0001) pnlDisplay.classList.add("positive");
      else if (unrealizedPnl < -0.0001) pnlDisplay.classList.add("negative");

      if (trendTicksLeft > 0) {
        if (trendBoost > 0) trendLabel.textContent = "Uptrend (boosted)";
        else if (trendBoost < 0) trendLabel.textContent = "Downtrend (boosted)";
      } else {
        trendLabel.textContent = "Neutral";
      }
    }

    // --- Price update loop ---
    function tick() {
      // Normal random movement
      let randomMove = (Math.random() - 0.5) * baseVolatility;

      // Apply trend boost while active
      if (trendTicksLeft > 0) {
        randomMove += trendBoost;
        trendTicksLeft--;
      } else {
        trendBoost = 0;
      }

      // Update price
      price = Math.max(1, price + randomMove);
      // Recalculate PnL
      if (position !== 0) {
        unrealizedPnl = (price - avgEntry) * position;
      } else {
        unrealizedPnl = 0;
      }

      updateUi();
    }

    setInterval(tick, tickMs);

    // --- Trade logic ---
    function onBuy(quantity = 1) {
      const tradePrice = price;

      // Update avg entry using simple weighted avg
      const newPosition = position + quantity;
      if (newPosition > 0) {
        avgEntry = (avgEntry * position + tradePrice * quantity) / newPosition;
      } else if (newPosition <= 0) {
        // If we flip from long to flat / short, just set avgEntry = tradePrice for short
        avgEntry = tradePrice;
      }

      position = newPosition;
      lastActionDisplay.textContent = `Bought ${quantity} @ ${formatMoney(tradePrice)}`;
      log(`Bought ${quantity} unit(s) @ ${formatMoney(tradePrice)}`);

      // Magic: when user buys, bias price upwards for a few ticks
      trendBoost = 0.30;         // strength of boost
      trendTicksLeft = 10;       // how many ticks it lasts

      updateUi();
    }

    function onSell(quantity = 1) {
      const tradePrice = price;

      const newPosition = position - quantity;
      // Realistically you'd realize PnL here; for a simple demo we'll just change position
      position = newPosition;

      if (position === 0) {
        avgEntry = 0;
      }

      lastActionDisplay.textContent = `Sold ${quantity} @ ${formatMoney(tradePrice)}`;
      log(`Sold ${quantity} unit(s) @ ${formatMoney(tradePrice)}`);

      // Optional: make sells less "lucky"
      trendBoost = -0.05;       // tiny downward bias
      trendTicksLeft = 6;

      updateUi();
    }

    function onReset() {
      price = 100;
      position = 0;
      avgEntry = 0;
      unrealizedPnl = 0;
      trendBoost = 0;
      trendTicksLeft = 0;
      lastActionDisplay.textContent = "None";
      trendLabel.textContent = "Neutral";
      log("Simulation reset.");
      updateUi();
    }

    // --- Wire up events ---
    buyBtn.addEventListener("click", () => onBuy(1));
    sellBtn.addEventListener("click", () => onSell(1));
    resetBtn.addEventListener("click", onReset);

    // Initial UI state
    updateUi();
    log("Simulation started. Waiting for orders...");
  </script>
</body>
</html>
